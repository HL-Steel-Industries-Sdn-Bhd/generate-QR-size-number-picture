<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>3cm Number Generator</title>
</head>
<body style="font-family: Arial; text-align:center; margin-top:40px;">

<h2>3cm × 3cm Number PNG Generator</h2>

<input type="text" id="number" placeholder="输入号码" 
       style="font-size:20px; padding:5px; width:120px;">
<button onclick="generate()" 
        style="font-size:20px; padding:6px 15px;">
Generate
</button>

<br><br>
<canvas id="preview" style="border:1px solid #ccc;"></canvas>

<script>
function generate() {
  const value = document.getElementById("number").value.trim();
  if (!value) {
    alert("请输入号码");
    return;
  }

  const size = 354; // 3cm @ 300 DPI
  const canvas = document.getElementById("preview");
  canvas.width = size;
  canvas.height = size;

  const ctx = canvas.getContext("2d");

  // 1. 先设置文本基线为 middle（关键修复！）
  ctx.textBaseline = "middle";
  ctx.textAlign = "center";

  // 背景
  ctx.fillStyle = "white";
  ctx.fillRect(0, 0, size, size);

  // 字体
  const fontSize = 280; // 稍微调小一点，留出边距
  ctx.font = "bold " + fontSize + "px Arial";
  ctx.fillStyle = "black";

  // 2. 直接使用画布中心点，配合textBaseline实现完美居中
  const centerX = size / 2;
  const centerY = size / 2;

  // 3. 测量文字宽度，确保不超出边界
  const metrics = ctx.measureText(value);
  const textWidth = metrics.width;
  
  // 如果文字太宽，按比例缩小字体
  let finalFontSize = fontSize;
  if (textWidth > size * 0.9) {
    finalFontSize = Math.floor(fontSize * (size * 0.9 / textWidth));
    ctx.font = "bold " + finalFontSize + "px Arial";
  }

  // 4. 绘制文字（已经自动居中了）
  ctx.fillText(value, centerX, centerY);

  // 可选：添加一个极淡的边框，方便查看边界
  ctx.strokeStyle = "#eee";
  ctx.lineWidth = 1;
  ctx.strokeRect(0, 0, size, size);

  // 下载
  const link = document.createElement("a");
  link.download = value + ".png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}
</script>

</body>
</html>
